Refactor the code to use classed and API created by Yuzhe Ruan.
